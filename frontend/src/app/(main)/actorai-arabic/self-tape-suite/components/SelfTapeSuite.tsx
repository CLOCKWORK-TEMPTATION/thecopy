"use client";

import { useState, useCallback, useEffect, useRef } from "react";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
  CardFooter,
} from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Textarea } from "@/components/ui/textarea";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

// ==================== Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====================

interface Take {
  id: string;
  name: string;
  duration: number;
  recordedAt: Date;
  videoUrl?: string;
  thumbnailUrl?: string;
  notes: TakeNote[];
  score?: number;
  status: "recording" | "completed" | "exported";
}

interface TakeNote {
  id: string;
  timestamp: number;
  type: "emotion" | "delivery" | "timing" | "movement" | "improvement";
  content: string;
  severity: "positive" | "neutral" | "needs_work";
  autoGenerated: boolean;
}

interface TeleprompterSettings {
  speed: number;
  fontSize: number;
  mirrorMode: boolean;
  highlightCurrentLine: boolean;
  autoScroll: boolean;
  countdownSeconds: number;
}

interface ExportSettings {
  quality: "casting" | "high" | "medium";
  format: "mp4" | "mov" | "webm";
  includeSlate: boolean;
  slateDuration: number;
  actorName: string;
  projectName: string;
  roleName: string;
  agencyName: string;
}

interface ComparisonView {
  leftTakeId: string | null;
  rightTakeId: string | null;
  syncPlayback: boolean;
}

type ActiveTool = "teleprompter" | "recorder" | "comparison" | "notes" | "export";

// ==================== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ====================

const SAMPLE_SCRIPT = `Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø£ÙˆÙ„ - ØºØ±ÙØ© Ø§Ù„Ù…Ø¹ÙŠØ´Ø© - Ù†Ù‡Ø§Ø±Ø§Ù‹

ØªØ¯Ø®Ù„ Ø³Ø§Ø±Ø© Ø§Ù„ØºØ±ÙØ© Ø¨Ø®Ø·ÙˆØ§Øª Ù…ØªØ«Ø§Ù‚Ù„Ø©ØŒ ØªØ­Ù…Ù„ ÙÙŠ ÙŠØ¯Ù‡Ø§ Ø±Ø³Ø§Ù„Ø© Ù…ÙØªÙˆØ­Ø©.

Ø³Ø§Ø±Ø©: (ØªÙ†Ø¸Ø± Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø¨ØµØ¯Ù…Ø©)
Ù„Ø§... Ù‡Ø°Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ù‚ÙŠÙ‚ÙŠØ§Ù‹.
ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù‡ Ø£Ù† ÙŠÙØ¹Ù„ Ù‡Ø°Ø§ Ø¨Ø¹Ø¯ ÙƒÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†ÙˆØ§ØªØŸ

(ØªØ¬Ù„Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±ÙŠÙƒØ©ØŒ ØªÙ…Ø³Ùƒ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨ÙŠØ¯ÙŠÙ† Ù…Ø±ØªØ¬ÙØªÙŠÙ†)

Ø³Ø§Ø±Ø©: (Ø¨ØµÙˆØª Ù…Ø®ØªÙ†Ù‚)
Ø¸Ù†Ù†Øª Ø£Ù†Ù†Ø§ ÙƒÙ†Ø§ Ø¹Ø§Ø¦Ù„Ø©...
Ø¸Ù†Ù†Øª Ø£Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ Ù‚Ø¯ Ø§Ù†ØªÙ‡Ù‰.

(ØªÙ†Ù‡Ø¶ ÙØ¬Ø£Ø©ØŒ ØªÙ…Ø´ÙŠ Ù†Ø­Ùˆ Ø§Ù„Ù†Ø§ÙØ°Ø©)

Ø³Ø§Ø±Ø©: (Ø¨Ø­Ø²Ù…)
Ù„ÙƒÙ†Ù†ÙŠ Ù„Ù† Ø£Ø³Ù…Ø­ Ù„Ù‡Ø°Ø§ Ø£Ù† ÙŠØ¯Ù…Ø± Ù…Ø§ Ø¨Ù†ÙŠØªÙ‡.
Ù„Ù‚Ø¯ ØªØºÙŠØ±Øª... ÙˆØ³Ø£Ø«Ø¨Øª Ø°Ù„Ùƒ.`;

const SAMPLE_TAKES: Take[] = [
  {
    id: "take-1",
    name: "Take 1 - Ø£ÙˆÙ„ÙŠ",
    duration: 125,
    recordedAt: new Date("2025-01-15T10:30:00"),
    thumbnailUrl: "/api/placeholder/320/180",
    notes: [
      {
        id: "n1",
        timestamp: 15,
        type: "emotion",
        content: "Ø§ÙØªØªØ§Ø­ÙŠØ© Ø¹Ø§Ø·ÙÙŠØ© Ù‚ÙˆÙŠØ© - Ø§Ù„ØµØ¯Ù…Ø© ÙˆØ§Ø¶Ø­Ø©",
        severity: "positive",
        autoGenerated: true,
      },
      {
        id: "n2",
        timestamp: 45,
        type: "delivery",
        content: "ÙŠÙ…ÙƒÙ† Ø¥Ø¨Ø·Ø§Ø¡ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ø¹ Ù‡Ù†Ø§ Ù„Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¯Ø±Ø§Ù…ÙŠ",
        severity: "needs_work",
        autoGenerated: true,
      },
      {
        id: "n3",
        timestamp: 90,
        type: "movement",
        content: "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù†Ø§ÙØ°Ø© Ø·Ø¨ÙŠØ¹ÙŠ ÙˆÙ…Ù‚Ù†Ø¹",
        severity: "positive",
        autoGenerated: true,
      },
    ],
    score: 78,
    status: "completed",
  },
  {
    id: "take-2",
    name: "Take 2 - ØªØ­Ø³ÙŠÙ†",
    duration: 132,
    recordedAt: new Date("2025-01-15T10:45:00"),
    thumbnailUrl: "/api/placeholder/320/180",
    notes: [
      {
        id: "n4",
        timestamp: 20,
        type: "emotion",
        content: "Ø¹Ù…Ù‚ Ø¹Ø§Ø·ÙÙŠ Ù…Ù…ØªØ§Ø² ÙÙŠ Ù„Ø­Ø¸Ø© Ø§Ù„ØµØ¯Ù…Ø©",
        severity: "positive",
        autoGenerated: true,
      },
      {
        id: "n5",
        timestamp: 50,
        type: "timing",
        content: "Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ - Ø§Ù„ÙˆÙ‚ÙØ© Ù…Ø¤Ø«Ø±Ø© Ø¬Ø¯Ø§Ù‹",
        severity: "positive",
        autoGenerated: true,
      },
      {
        id: "n6",
        timestamp: 100,
        type: "improvement",
        content: "Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‚ÙˆÙŠØ© ØªØ­ØªØ§Ø¬ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø­Ø²Ù… ÙÙŠ Ø§Ù„ØµÙˆØª",
        severity: "neutral",
        autoGenerated: true,
      },
    ],
    score: 85,
    status: "completed",
  },
  {
    id: "take-3",
    name: "Take 3 - Ù†Ù‡Ø§Ø¦ÙŠ",
    duration: 128,
    recordedAt: new Date("2025-01-15T11:00:00"),
    thumbnailUrl: "/api/placeholder/320/180",
    notes: [
      {
        id: "n7",
        timestamp: 18,
        type: "emotion",
        content: "Ø£Ø¯Ø§Ø¡ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ - Ø§Ù„ØµØ¯Ù‚ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ ÙˆØ§Ø¶Ø­",
        severity: "positive",
        autoGenerated: true,
      },
      {
        id: "n8",
        timestamp: 55,
        type: "delivery",
        content: "Ø¥Ù„Ù‚Ø§Ø¡ Ù…Ø«Ø§Ù„ÙŠ Ù…Ø¹ ØªÙ†ÙˆØ¹ Ù†ØºÙ…ÙŠ Ø±Ø§Ø¦Ø¹",
        severity: "positive",
        autoGenerated: true,
      },
      {
        id: "n9",
        timestamp: 95,
        type: "movement",
        content: "Ù„ØºØ© Ø§Ù„Ø¬Ø³Ø¯ Ù…Ø¹Ø¨Ø±Ø© ÙˆÙ…ØªÙ†Ø§Ø³Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±",
        severity: "positive",
        autoGenerated: true,
      },
    ],
    score: 92,
    status: "completed",
  },
];

// ==================== Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ====================

export const SelfTapeSuite: React.FC = () => {
  // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  const [activeTool, setActiveTool] = useState<ActiveTool>("teleprompter");
  const [scriptText, setScriptText] = useState(SAMPLE_SCRIPT);
  const [takes, setTakes] = useState<Take[]>(SAMPLE_TAKES);

  // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  const [notification, setNotification] = useState<{
    type: "success" | "error" | "info";
    message: string;
  } | null>(null);

  // Ø­Ø§Ù„Ø© Teleprompter
  const [teleprompterSettings, setTeleprompterSettings] = useState<TeleprompterSettings>({
    speed: 50,
    fontSize: 32,
    mirrorMode: false,
    highlightCurrentLine: true,
    autoScroll: true,
    countdownSeconds: 5,
  });
  const [teleprompterRunning, setTeleprompterRunning] = useState(false);
  const [teleprompterPosition, setTeleprompterPosition] = useState(0);
  const [countdown, setCountdown] = useState(0);

  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  const [isRecording, setIsRecording] = useState(false);
  const [recordingTime, setRecordingTime] = useState(0);
  const [currentTake, setCurrentTake] = useState<Take | null>(null);
  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);
  const teleprompterIntervalRef = useRef<NodeJS.Timeout | null>(null);

  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
  const [comparisonView, setComparisonView] = useState<ComparisonView>({
    leftTakeId: takes[0]?.id || null,
    rightTakeId: takes[1]?.id || null,
    syncPlayback: true,
  });

  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØµØ¯ÙŠØ±
  const [exportSettings, setExportSettings] = useState<ExportSettings>({
    quality: "casting",
    format: "mp4",
    includeSlate: true,
    slateDuration: 5,
    actorName: "",
    projectName: "",
    roleName: "",
    agencyName: "",
  });
  const [isExporting, setIsExporting] = useState(false);
  const [exportProgress, setExportProgress] = useState(0);

  // Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª
  useEffect(() => {
    return () => {
      if (recordingIntervalRef.current) clearInterval(recordingIntervalRef.current);
      if (teleprompterIntervalRef.current) clearInterval(teleprompterIntervalRef.current);
    };
  }, []);

  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  useEffect(() => {
    if (notification) {
      const timer = setTimeout(() => setNotification(null), 4000);
      return () => clearTimeout(timer);
    }
    return undefined;
  }, [notification]);

  // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
  const showNotification = useCallback(
    (type: "success" | "error" | "info", message: string) => {
      setNotification({ type, message });
    },
    []
  );

  // ==================== Ø¯ÙˆØ§Ù„ Teleprompter ====================

  const startTeleprompter = useCallback(() => {
    if (teleprompterSettings.countdownSeconds > 0) {
      setCountdown(teleprompterSettings.countdownSeconds);
      const countdownInterval = setInterval(() => {
        setCountdown((prev) => {
          if (prev <= 1) {
            clearInterval(countdownInterval);
            setTeleprompterRunning(true);
            return 0;
          }
          return prev - 1;
        });
      }, 1000);
    } else {
      setTeleprompterRunning(true);
    }
  }, [teleprompterSettings.countdownSeconds]);

  const stopTeleprompter = useCallback(() => {
    setTeleprompterRunning(false);
    setCountdown(0);
    if (teleprompterIntervalRef.current) {
      clearInterval(teleprompterIntervalRef.current);
    }
  }, []);

  const resetTeleprompter = useCallback(() => {
    stopTeleprompter();
    setTeleprompterPosition(0);
  }, [stopTeleprompter]);

  // ØªØ­Ø±ÙŠÙƒ Teleprompter
  useEffect(() => {
    if (teleprompterRunning && teleprompterSettings.autoScroll) {
      teleprompterIntervalRef.current = setInterval(() => {
        setTeleprompterPosition((prev) => {
          const maxPosition = 100;
          const newPosition = prev + teleprompterSettings.speed / 500;
          if (newPosition >= maxPosition) {
            setTeleprompterRunning(false);
            return maxPosition;
          }
          return newPosition;
        });
      }, 100);
    } else if (teleprompterIntervalRef.current) {
      clearInterval(teleprompterIntervalRef.current);
    }

    return () => {
      if (teleprompterIntervalRef.current) {
        clearInterval(teleprompterIntervalRef.current);
      }
    };
  }, [teleprompterRunning, teleprompterSettings.autoScroll, teleprompterSettings.speed]);

  // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ====================

  const startRecording = useCallback(() => {
    const newTake: Take = {
      id: `take-${Date.now()}`,
      name: `Take ${takes.length + 1}`,
      duration: 0,
      recordedAt: new Date(),
      notes: [],
      status: "recording",
    };
    setCurrentTake(newTake);
    setIsRecording(true);
    setRecordingTime(0);

    recordingIntervalRef.current = setInterval(() => {
      setRecordingTime((prev) => prev + 1);
    }, 1000);

    // Ø¨Ø¯Ø¡ Teleprompter ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    startTeleprompter();

    showNotification("info", "ğŸ¬ Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...");
  }, [takes.length, startTeleprompter, showNotification]);

  const stopRecording = useCallback(() => {
    setIsRecording(false);
    stopTeleprompter();

    if (recordingIntervalRef.current) {
      clearInterval(recordingIntervalRef.current);
    }

    if (currentTake) {
      const completedTake: Take = {
        ...currentTake,
        duration: recordingTime,
        status: "completed",
        notes: generateAutoNotes(recordingTime),
        score: Math.floor(Math.random() * 20) + 75,
      };
      setTakes((prev) => [...prev, completedTake]);
      setCurrentTake(null);
      showNotification("success", `âœ… ØªÙ… Ø­ÙØ¸ ${completedTake.name} Ø¨Ù†Ø¬Ø§Ø­`);
    }

    setRecordingTime(0);
    resetTeleprompter();
  }, [currentTake, recordingTime, stopTeleprompter, resetTeleprompter, showNotification]);

  // ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
  const generateAutoNotes = (duration: number): TakeNote[] => {
    const noteTypes: TakeNote["type"][] = ["emotion", "delivery", "timing", "movement", "improvement"];
    const positiveComments = [
      "Ø£Ø¯Ø§Ø¡ Ø¹Ø§Ø·ÙÙŠ Ù…Ù‚Ù†Ø¹",
      "Ø¥ÙŠÙ‚Ø§Ø¹ Ù…Ù…ØªØ§Ø² ÙÙŠ Ø§Ù„Ø¥Ù„Ù‚Ø§Ø¡",
      "ØªØ¹Ø¨ÙŠØ±Ø§Øª ÙˆØ¬Ù‡ Ø·Ø¨ÙŠØ¹ÙŠØ©",
      "Ø­Ø±ÙƒØ© Ù…Ø³Ø±Ø­ÙŠØ© Ø³Ù„Ø³Ø©",
      "ØµØ¯Ù‚ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡",
    ];
    const neutralComments = [
      "ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„Ù†ØºÙ…ÙŠ",
      "Ø¬Ø±Ø¨ Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚ÙØ© Ø¯Ø±Ø§Ù…ÙŠØ© Ù‡Ù†Ø§",
      "Ø§Ù„Ù†Ø¸Ø±Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬ÙŠØ¯Ø©ØŒ Ø¬Ø±Ø¨ Ø²Ø§ÙˆÙŠØ© Ù…Ø®ØªÙ„ÙØ©",
      "Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ«Ø±",
    ];

    const notes: TakeNote[] = [];
    const numNotes = Math.floor(Math.random() * 3) + 2;

    for (let i = 0; i < numNotes; i++) {
      const isPositive = Math.random() > 0.4;
      const noteType = noteTypes[Math.floor(Math.random() * noteTypes.length)] ?? "timing";
      const content = isPositive
        ? (positiveComments[Math.floor(Math.random() * positiveComments.length)] ?? "Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯")
        : (neutralComments[Math.floor(Math.random() * neutralComments.length)] ?? "Ù…Ù„Ø§Ø­Ø¸Ø©");
      notes.push({
        id: `auto-${Date.now()}-${i}`,
        timestamp: Math.floor((duration / numNotes) * (i + 0.5)),
        type: noteType,
        content,
        severity: isPositive ? "positive" : "neutral",
        autoGenerated: true,
      });
    }

    return notes;
  };

  // Ø­Ø°Ù Take
  const deleteTake = useCallback(
    (takeId: string) => {
      setTakes((prev) => prev.filter((t) => t.id !== takeId));
      showNotification("info", "ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
    },
    [showNotification]
  );

  // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± ====================

  const startExport = useCallback(
    async (takeId: string) => {
      const take = takes.find((t) => t.id === takeId);
      if (!take) return;

      setIsExporting(true);
      setExportProgress(0);

      // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ±
      const exportSteps = [
        "ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...",
        "Ø¥Ø¶Ø§ÙØ© Slate...",
        "Ø¶Ø¨Ø· Ø§Ù„Ø¬ÙˆØ¯Ø©...",
        "ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚...",
        "Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±...",
      ];

      for (let i = 0; i <= 100; i += 5) {
        await new Promise((resolve) => setTimeout(resolve, 150));
        setExportProgress(i);
      }

      setIsExporting(false);
      setExportProgress(0);
      showNotification(
        "success",
        `âœ… ØªÙ… ØªØµØ¯ÙŠØ± "${take.name}" Ø¨Ø¬ÙˆØ¯Ø© ${
          exportSettings.quality === "casting" ? "Casting" : exportSettings.quality
        }`
      );
    },
    [takes, exportSettings.quality, showNotification]
  );

  // ==================== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª ====================

  const formatTime = (seconds: number): string => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
  };

  // ==================== Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Take ====================

  const getTakeById = (id: string | null): Take | undefined => {
    return takes.find((t) => t.id === id);
  };

  // ==================== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ====================

  return (
    <div className="min-h-screen bg-gradient-to-bl from-slate-900 via-purple-900 to-slate-900" dir="rtl">
      {/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
      <header className="border-b border-purple-500/30 bg-black/30 backdrop-blur-sm">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center">
                <span className="text-2xl">ğŸ¥</span>
              </div>
              <div>
                <h1 className="text-2xl font-bold text-white">Self-Tape Suite</h1>
                <p className="text-purple-300 text-sm">Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø°Ø§ØªÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
              </div>
            </div>

            <div className="flex items-center gap-3">
              <Badge variant="outline" className="border-green-500 text-green-400">
                ğŸš€ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
              </Badge>
              <Button
                variant="outline"
                className="border-purple-500 text-purple-300 hover:bg-purple-500/20"
                onClick={() => (window.location.href = "/actorai-arabic")}
              >
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
              </Button>
            </div>
          </div>
        </div>
      </header>

      {/* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */}
      {notification && (
        <div className="fixed top-20 left-1/2 -translate-x-1/2 z-50 animate-in fade-in slide-in-from-top-5">
          <Alert
            className={`${
              notification.type === "success"
                ? "bg-green-500/20 border-green-500 text-green-300"
                : notification.type === "error"
                ? "bg-red-500/20 border-red-500 text-red-300"
                : "bg-blue-500/20 border-blue-500 text-blue-300"
            }`}
          >
            <AlertDescription className="text-lg">{notification.message}</AlertDescription>
          </Alert>
        </div>
      )}

      {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
      <main className="container mx-auto px-4 py-6">
        {/* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */}
        <div className="flex flex-wrap gap-2 mb-6">
          {[
            { id: "teleprompter", label: "ğŸ“œ Teleprompter", icon: "ğŸ“œ" },
            { id: "recorder", label: "ğŸ¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„", icon: "ğŸ¬" },
            { id: "comparison", label: "âš–ï¸ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©", icon: "âš–ï¸" },
            { id: "notes", label: "ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª", icon: "ğŸ“" },
            { id: "export", label: "ğŸ“¤ Ø§Ù„ØªØµØ¯ÙŠØ±", icon: "ğŸ“¤" },
          ].map((tool) => (
            <Button
              key={tool.id}
              variant={activeTool === tool.id ? "default" : "outline"}
              className={`${
                activeTool === tool.id
                  ? "bg-purple-600 hover:bg-purple-700 text-white"
                  : "border-purple-500/50 text-purple-300 hover:bg-purple-500/20"
              }`}
              onClick={() => setActiveTool(tool.id as ActiveTool)}
            >
              {tool.label}
            </Button>
          ))}
        </div>

        {/* ==================== Teleprompter Ø°ÙƒÙŠ ==================== */}
        {activeTool === "teleprompter" && (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Teleprompter */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>âš™ï¸</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Teleprompter
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Ø§Ù„Ø³Ø±Ø¹Ø© */}
                <div className="space-y-2">
                  <Label className="text-purple-300">Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ±: {teleprompterSettings.speed}%</Label>
                  <Slider
                    value={[teleprompterSettings.speed]}
                    onValueChange={([value]) =>
                      setTeleprompterSettings((prev) => ({ ...prev, speed: value ?? prev.speed }))
                    }
                    min={10}
                    max={100}
                    step={5}
                    className="w-full"
                  />
                </div>

                {/* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */}
                <div className="space-y-2">
                  <Label className="text-purple-300">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·: {teleprompterSettings.fontSize}px</Label>
                  <Slider
                    value={[teleprompterSettings.fontSize]}
                    onValueChange={([value]) =>
                      setTeleprompterSettings((prev) => ({ ...prev, fontSize: value ?? prev.fontSize }))
                    }
                    min={18}
                    max={72}
                    step={2}
                    className="w-full"
                  />
                </div>

                {/* Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ */}
                <div className="space-y-2">
                  <Label className="text-purple-300">
                    Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ: {teleprompterSettings.countdownSeconds} Ø«ÙˆØ§Ù†
                  </Label>
                  <Slider
                    value={[teleprompterSettings.countdownSeconds]}
                    onValueChange={([value]) =>
                      setTeleprompterSettings((prev) => ({ ...prev, countdownSeconds: value ?? prev.countdownSeconds }))
                    }
                    min={0}
                    max={10}
                    step={1}
                    className="w-full"
                  />
                </div>

                {/* Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */}
                <div className="space-y-3">
                  <div className="flex items-center justify-between">
                    <Label className="text-purple-300">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø±Ø¢Ø©</Label>
                    <Button
                      variant="outline"
                      size="sm"
                      className={`${
                        teleprompterSettings.mirrorMode
                          ? "bg-purple-600 border-purple-600"
                          : "border-purple-500/50"
                      } text-white`}
                      onClick={() =>
                        setTeleprompterSettings((prev) => ({
                          ...prev,
                          mirrorMode: !prev.mirrorMode,
                        }))
                      }
                    >
                      {teleprompterSettings.mirrorMode ? "âœ“ Ù…ÙØ¹Ù„" : "Ù…Ø¹Ø·Ù„"}
                    </Button>
                  </div>

                  <div className="flex items-center justify-between">
                    <Label className="text-purple-300">ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</Label>
                    <Button
                      variant="outline"
                      size="sm"
                      className={`${
                        teleprompterSettings.highlightCurrentLine
                          ? "bg-purple-600 border-purple-600"
                          : "border-purple-500/50"
                      } text-white`}
                      onClick={() =>
                        setTeleprompterSettings((prev) => ({
                          ...prev,
                          highlightCurrentLine: !prev.highlightCurrentLine,
                        }))
                      }
                    >
                      {teleprompterSettings.highlightCurrentLine ? "âœ“ Ù…ÙØ¹Ù„" : "Ù…Ø¹Ø·Ù„"}
                    </Button>
                  </div>
                </div>

                {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */}
                <div className="flex gap-2 pt-4">
                  {!teleprompterRunning ? (
                    <Button
                      className="flex-1 bg-green-600 hover:bg-green-700"
                      onClick={startTeleprompter}
                      disabled={countdown > 0}
                    >
                      {countdown > 0 ? `${countdown}...` : "â–¶ï¸ ØªØ´ØºÙŠÙ„"}
                    </Button>
                  ) : (
                    <Button className="flex-1 bg-yellow-600 hover:bg-yellow-700" onClick={stopTeleprompter}>
                      â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
                    </Button>
                  )}
                  <Button
                    variant="outline"
                    className="border-purple-500/50 text-purple-300"
                    onClick={resetTeleprompter}
                  >
                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©
                  </Button>
                </div>
              </CardContent>
            </Card>

            {/* Ø´Ø§Ø´Ø© Teleprompter */}
            <Card className="lg:col-span-2 bg-black border-purple-500/30 min-h-[500px]">
              <CardContent className="p-0 h-full">
                <div
                  className={`h-full overflow-hidden relative ${
                    teleprompterSettings.mirrorMode ? "scale-x-[-1]" : ""
                  }`}
                >
                  {/* Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ */}
                  {countdown > 0 && (
                    <div className="absolute inset-0 flex items-center justify-center bg-black/80 z-10">
                      <span className="text-9xl font-bold text-purple-500 animate-pulse">{countdown}</span>
                    </div>
                  )}

                  {/* Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… */}
                  <div className="absolute top-0 left-0 right-0 h-1 bg-purple-900">
                    <div
                      className="h-full bg-purple-500 transition-all duration-100"
                      style={{ width: `${teleprompterPosition}%` }}
                    />
                  </div>

                  {/* Ø§Ù„Ù†Øµ */}
                  <div
                    className="p-8 text-white leading-relaxed transition-transform duration-100"
                    style={{
                      fontSize: `${teleprompterSettings.fontSize}px`,
                      transform: `translateY(-${teleprompterPosition * 3}px)`,
                    }}
                  >
                    {scriptText.split("\n").map((line, index) => {
                      const lineProgress = (index / scriptText.split("\n").length) * 100;
                      const isCurrentLine =
                        teleprompterSettings.highlightCurrentLine &&
                        Math.abs(lineProgress - teleprompterPosition) < 10;

                      return (
                        <p
                          key={index}
                          className={`mb-4 transition-all duration-300 ${
                            isCurrentLine
                              ? "text-yellow-300 scale-105 bg-yellow-500/10 px-4 py-2 rounded-lg"
                              : lineProgress < teleprompterPosition
                              ? "text-gray-500"
                              : "text-white"
                          }`}
                        >
                          {line || "\u00A0"}
                        </p>
                      );
                    })}
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Ù…Ø­Ø±Ø± Ø§Ù„Ù†Øµ */}
            <Card className="lg:col-span-3 bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>âœï¸</span> Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ù‚Ø±Ø§Ø¡ØªÙ‡
                </CardTitle>
                <CardDescription className="text-purple-300">
                  Ø£Ø¯Ø®Ù„ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù†Øµ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„Ù‡
                </CardDescription>
              </CardHeader>
              <CardContent>
                <Textarea
                  value={scriptText}
                  onChange={(e) => setScriptText(e.target.value)}
                  className="min-h-[200px] bg-slate-900/50 border-purple-500/30 text-white text-lg"
                  placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù‡Ù†Ø§..."
                  dir="rtl"
                />
              </CardContent>
            </Card>
          </div>
        )}

        {/* ==================== ØªØ³Ø¬ÙŠÙ„ Takes Ù…ØªØ¹Ø¯Ø¯Ø© ==================== */}
        {activeTool === "recorder" && (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>ğŸ¬</span> Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                </CardTitle>
                <CardDescription className="text-purple-300">
                  Ø³Ø¬Ù„ Takes Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆÙ‚Ø§Ø±Ù† Ø¨ÙŠÙ†Ù‡Ø§
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */}
                <div className="aspect-video bg-black rounded-xl border-2 border-purple-500/30 flex items-center justify-center relative overflow-hidden">
                  {isRecording && (
                    <div className="absolute top-4 right-4 flex items-center gap-2">
                      <div className="w-4 h-4 bg-red-500 rounded-full animate-pulse" />
                      <span className="text-red-400 font-mono text-lg">{formatTime(recordingTime)}</span>
                    </div>
                  )}

                  <div className="text-center">
                    <div className="w-24 h-24 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-4">
                      <span className="text-5xl">{isRecording ? "ğŸ”´" : "ğŸ“¹"}</span>
                    </div>
                    <p className="text-gray-400">
                      {isRecording ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„..." : "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"}
                    </p>
                  </div>

                  {/* Ù…ØµØºØ± Teleprompter */}
                  {isRecording && (
                    <div className="absolute bottom-0 left-0 right-0 bg-black/70 p-3 text-white text-center">
                      <p className="text-lg line-clamp-2">{scriptText.split("\n")[0]}</p>
                    </div>
                  )}
                </div>

                {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */}
                <div className="flex gap-3 justify-center">
                  {!isRecording ? (
                    <Button
                      size="lg"
                      className="bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-xl"
                      onClick={startRecording}
                    >
                      ğŸ¬ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    </Button>
                  ) : (
                    <Button
                      size="lg"
                      className="bg-gray-600 hover:bg-gray-700 text-white px-8 py-6 text-xl"
                      onClick={stopRecording}
                    >
                      â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    </Button>
                  )}
                </div>

                {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø© */}
                <div className="grid grid-cols-3 gap-4 pt-4 border-t border-purple-500/30">
                  <div className="text-center">
                    <p className="text-3xl font-bold text-purple-400">{takes.length}</p>
                    <p className="text-sm text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Takes</p>
                  </div>
                  <div className="text-center">
                    <p className="text-3xl font-bold text-green-400">
                      {takes.length > 0 ? Math.max(...takes.map((t) => t.score || 0)) : 0}%
                    </p>
                    <p className="text-sm text-gray-400">Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…</p>
                  </div>
                  <div className="text-center">
                    <p className="text-3xl font-bold text-blue-400">
                      {formatTime(takes.reduce((acc, t) => acc + t.duration, 0))}
                    </p>
                    <p className="text-sm text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Ù‚Ø§Ø¦Ù…Ø© Takes */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>ğŸ“‹</span> Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª ({takes.length})
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3 max-h-[500px] overflow-y-auto">
                  {takes.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <span className="text-5xl mb-4 block">ğŸ¬</span>
                      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</p>
                      <p className="text-sm">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ Take</p>
                    </div>
                  ) : (
                    takes.map((take, index) => (
                      <div
                        key={take.id}
                        className="bg-slate-900/50 rounded-xl p-4 border border-purple-500/20 hover:border-purple-500/50 transition-all"
                      >
                        <div className="flex items-start justify-between mb-3">
                          <div>
                            <h4 className="text-white font-medium flex items-center gap-2">
                              {take.name}
                              {take.score && take.score >= 85 && (
                                <Badge className="bg-green-500/20 text-green-400 text-xs">â­ Ù…Ù…ØªØ§Ø²</Badge>
                              )}
                            </h4>
                            <p className="text-sm text-gray-400">
                              {take.recordedAt.toLocaleTimeString("ar-EG")} â€¢ {formatTime(take.duration)}
                            </p>
                          </div>
                          {take.score && (
                            <div
                              className={`text-2xl font-bold ${
                                take.score >= 85
                                  ? "text-green-400"
                                  : take.score >= 70
                                  ? "text-yellow-400"
                                  : "text-red-400"
                              }`}
                            >
                              {take.score}%
                            </div>
                          )}
                        </div>

                        {/* Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø®ØªØµØ±Ø© */}
                        {take.notes.length > 0 && (
                          <div className="mb-3">
                            <p className="text-xs text-purple-300 mb-1">
                              {take.notes.length} Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                            </p>
                            <p className="text-sm text-gray-300 line-clamp-1">
                              {take.notes[0]?.content}
                            </p>
                          </div>
                        )}

                        {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */}
                        <div className="flex gap-2">
                          <Button
                            size="sm"
                            variant="outline"
                            className="flex-1 border-purple-500/50 text-purple-300 hover:bg-purple-500/20"
                            onClick={() => {
                              setActiveTool("notes");
                            }}
                          >
                            ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                          </Button>
                          <Button
                            size="sm"
                            variant="outline"
                            className="flex-1 border-green-500/50 text-green-300 hover:bg-green-500/20"
                            onClick={() => startExport(take.id)}
                          >
                            ğŸ“¤ ØªØµØ¯ÙŠØ±
                          </Button>
                          <Button
                            size="sm"
                            variant="outline"
                            className="border-red-500/50 text-red-300 hover:bg-red-500/20"
                            onClick={() => deleteTake(take.id)}
                          >
                            ğŸ—‘ï¸
                          </Button>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </CardContent>
            </Card>
          </div>
        )}

        {/* ==================== Ù…Ù‚Ø§Ø±Ù†Ø© Ø¬Ù†Ø¨-Ù„Ø¬Ù†Ø¨ ==================== */}
        {activeTool === "comparison" && (
          <div className="space-y-6">
            {/* Ø§Ø®ØªÙŠØ§Ø± Takes Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>âš–ï¸</span> Ù…Ù‚Ø§Ø±Ù†Ø© Takes Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨
                </CardTitle>
                <CardDescription className="text-purple-300">
                  Ø§Ø®ØªØ± ØªØ³Ø¬ÙŠÙ„ÙŠÙ† Ù„Ù…Ù‚Ø§Ø±Ù†ØªÙ‡Ù…Ø§ ÙˆÙ…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                  <div>
                    <Label className="text-purple-300 mb-2 block">Take Ø§Ù„Ø£ÙŠØ³Ø±</Label>
                    <Select
                      value={comparisonView.leftTakeId || ""}
                      onValueChange={(value) =>
                        setComparisonView((prev) => ({ ...prev, leftTakeId: value }))
                      }
                    >
                      <SelectTrigger className="bg-slate-900/50 border-purple-500/30 text-white">
                        <SelectValue placeholder="Ø§Ø®ØªØ± Take" />
                      </SelectTrigger>
                      <SelectContent className="bg-slate-900 border-purple-500/30">
                        {takes.map((take) => (
                          <SelectItem key={take.id} value={take.id} className="text-white">
                            {take.name} ({take.score}%)
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="text-center">
                    <Button
                      variant="outline"
                      className={`border-purple-500/50 ${
                        comparisonView.syncPlayback ? "bg-purple-600" : ""
                      } text-white`}
                      onClick={() =>
                        setComparisonView((prev) => ({
                          ...prev,
                          syncPlayback: !prev.syncPlayback,
                        }))
                      }
                    >
                      {comparisonView.syncPlayback ? "ğŸ”— Ù…ØªØ²Ø§Ù…Ù†" : "ğŸ”“ Ù…Ù†ÙØµÙ„"}
                    </Button>
                  </div>

                  <div>
                    <Label className="text-purple-300 mb-2 block">Take Ø§Ù„Ø£ÙŠÙ…Ù†</Label>
                    <Select
                      value={comparisonView.rightTakeId || ""}
                      onValueChange={(value) =>
                        setComparisonView((prev) => ({ ...prev, rightTakeId: value }))
                      }
                    >
                      <SelectTrigger className="bg-slate-900/50 border-purple-500/30 text-white">
                        <SelectValue placeholder="Ø§Ø®ØªØ± Take" />
                      </SelectTrigger>
                      <SelectContent className="bg-slate-900 border-purple-500/30">
                        {takes.map((take) => (
                          <SelectItem key={take.id} value={take.id} className="text-white">
                            {take.name} ({take.score}%)
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Take Ø§Ù„Ø£ÙŠØ³Ø± */}
              <Card className="bg-slate-800/50 border-purple-500/30">
                <CardHeader className="pb-2">
                  <CardTitle className="text-white text-lg">
                    {getTakeById(comparisonView.leftTakeId)?.name || "Ø§Ø®ØªØ± Take"}
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="aspect-video bg-black rounded-lg flex items-center justify-center mb-4">
                    <span className="text-6xl">ğŸ“¹</span>
                  </div>
                  {comparisonView.leftTakeId && (
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                        <span className="text-green-400 font-bold">
                          {getTakeById(comparisonView.leftTakeId)?.score}%
                        </span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„Ù…Ø¯Ø©:</span>
                        <span className="text-white">
                          {formatTime(getTakeById(comparisonView.leftTakeId)?.duration || 0)}
                        </span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>
                        <span className="text-purple-300">
                          {getTakeById(comparisonView.leftTakeId)?.notes.length} Ù…Ù„Ø§Ø­Ø¸Ø©
                        </span>
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* Take Ø§Ù„Ø£ÙŠÙ…Ù† */}
              <Card className="bg-slate-800/50 border-purple-500/30">
                <CardHeader className="pb-2">
                  <CardTitle className="text-white text-lg">
                    {getTakeById(comparisonView.rightTakeId)?.name || "Ø§Ø®ØªØ± Take"}
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="aspect-video bg-black rounded-lg flex items-center justify-center mb-4">
                    <span className="text-6xl">ğŸ“¹</span>
                  </div>
                  {comparisonView.rightTakeId && (
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                        <span className="text-green-400 font-bold">
                          {getTakeById(comparisonView.rightTakeId)?.score}%
                        </span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„Ù…Ø¯Ø©:</span>
                        <span className="text-white">
                          {formatTime(getTakeById(comparisonView.rightTakeId)?.duration || 0)}
                        </span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>
                        <span className="text-purple-300">
                          {getTakeById(comparisonView.rightTakeId)?.notes.length} Ù…Ù„Ø§Ø­Ø¸Ø©
                        </span>
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>

            {/* Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© */}
            {comparisonView.leftTakeId && comparisonView.rightTakeId && (
              <Card className="bg-slate-800/50 border-purple-500/30">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <span>ğŸ“Š</span> Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="text-center p-4 bg-slate-900/50 rounded-xl">
                      <p className="text-gray-400 text-sm mb-2">ÙØ±Ù‚ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                      <p
                        className={`text-3xl font-bold ${
                          (getTakeById(comparisonView.rightTakeId)?.score || 0) >
                          (getTakeById(comparisonView.leftTakeId)?.score || 0)
                            ? "text-green-400"
                            : "text-red-400"
                        }`}
                      >
                        {(getTakeById(comparisonView.rightTakeId)?.score || 0) -
                          (getTakeById(comparisonView.leftTakeId)?.score || 0) >
                        0
                          ? "+"
                          : ""}
                        {(getTakeById(comparisonView.rightTakeId)?.score || 0) -
                          (getTakeById(comparisonView.leftTakeId)?.score || 0)}
                        %
                      </p>
                    </div>
                    <div className="text-center p-4 bg-slate-900/50 rounded-xl">
                      <p className="text-gray-400 text-sm mb-2">ÙØ±Ù‚ Ø§Ù„Ù…Ø¯Ø©</p>
                      <p className="text-3xl font-bold text-purple-400">
                        {Math.abs(
                          (getTakeById(comparisonView.rightTakeId)?.duration || 0) -
                            (getTakeById(comparisonView.leftTakeId)?.duration || 0)
                        )}
                        Ø«
                      </p>
                    </div>
                    <div className="text-center p-4 bg-slate-900/50 rounded-xl">
                      <p className="text-gray-400 text-sm mb-2">Ø§Ù„Ø£ÙØ¶Ù„</p>
                      <p className="text-xl font-bold text-yellow-400">
                        {(getTakeById(comparisonView.rightTakeId)?.score || 0) >
                        (getTakeById(comparisonView.leftTakeId)?.score || 0)
                          ? getTakeById(comparisonView.rightTakeId)?.name
                          : getTakeById(comparisonView.leftTakeId)?.name}
                      </p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            )}
          </div>
        )}

        {/* ==================== Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ==================== */}
        {activeTool === "notes" && (
          <div className="space-y-6">
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>ğŸ“</span> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø£Ø¯Ø§Ø¡
                </CardTitle>
                <CardDescription className="text-purple-300">
                  Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙÙˆÙ„ÙÙ‘Ø¯Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ùƒ
                </CardDescription>
              </CardHeader>
              <CardContent>
                <Tabs defaultValue={takes[0]?.id ?? ""} className="w-full">
                  <TabsList className="bg-slate-900/50 border border-purple-500/30 mb-4 flex-wrap h-auto gap-2 p-2">
                    {takes.map((take) => (
                      <TabsTrigger
                        key={take.id}
                        value={take.id}
                        className="data-[state=active]:bg-purple-600 text-white"
                      >
                        {take.name}
                      </TabsTrigger>
                    ))}
                  </TabsList>

                  {takes.map((take) => (
                    <TabsContent key={take.id} value={take.id}>
                      <div className="space-y-4">
                        {/* Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                          <div className="bg-slate-900/50 rounded-xl p-4 text-center">
                            <p className="text-gray-400 text-sm">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</p>
                            <p
                              className={`text-3xl font-bold ${
                                (take.score || 0) >= 85
                                  ? "text-green-400"
                                  : (take.score || 0) >= 70
                                  ? "text-yellow-400"
                                  : "text-red-400"
                              }`}
                            >
                              {take.score}%
                            </p>
                          </div>
                          <div className="bg-slate-900/50 rounded-xl p-4 text-center">
                            <p className="text-gray-400 text-sm">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</p>
                            <p className="text-3xl font-bold text-green-400">
                              {take.notes.filter((n) => n.severity === "positive").length}
                            </p>
                          </div>
                          <div className="bg-slate-900/50 rounded-xl p-4 text-center">
                            <p className="text-gray-400 text-sm">ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</p>
                            <p className="text-3xl font-bold text-yellow-400">
                              {take.notes.filter((n) => n.severity === "needs_work").length}
                            </p>
                          </div>
                          <div className="bg-slate-900/50 rounded-xl p-4 text-center">
                            <p className="text-gray-400 text-sm">Ø§Ù„Ù…Ø¯Ø©</p>
                            <p className="text-3xl font-bold text-purple-400">
                              {formatTime(take.duration)}
                            </p>
                          </div>
                        </div>

                        {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */}
                        <div className="space-y-3">
                          {take.notes.map((note) => (
                            <div
                              key={note.id}
                              className={`p-4 rounded-xl border ${
                                note.severity === "positive"
                                  ? "bg-green-500/10 border-green-500/30"
                                  : note.severity === "needs_work"
                                  ? "bg-yellow-500/10 border-yellow-500/30"
                                  : "bg-slate-900/50 border-purple-500/30"
                              }`}
                            >
                              <div className="flex items-start justify-between mb-2">
                                <div className="flex items-center gap-2">
                                  <Badge
                                    className={`${
                                      note.type === "emotion"
                                        ? "bg-pink-500/20 text-pink-300"
                                        : note.type === "delivery"
                                        ? "bg-blue-500/20 text-blue-300"
                                        : note.type === "timing"
                                        ? "bg-purple-500/20 text-purple-300"
                                        : note.type === "movement"
                                        ? "bg-orange-500/20 text-orange-300"
                                        : "bg-cyan-500/20 text-cyan-300"
                                    }`}
                                  >
                                    {note.type === "emotion"
                                      ? "ğŸ’« Ø¹Ø§Ø·ÙØ©"
                                      : note.type === "delivery"
                                      ? "ğŸ¤ Ø¥Ù„Ù‚Ø§Ø¡"
                                      : note.type === "timing"
                                      ? "â±ï¸ ØªÙˆÙ‚ÙŠØª"
                                      : note.type === "movement"
                                      ? "ğŸ­ Ø­Ø±ÙƒØ©"
                                      : "ğŸ’¡ ØªØ­Ø³ÙŠÙ†"}
                                  </Badge>
                                  <span className="text-gray-400 text-sm">
                                    @ {formatTime(note.timestamp)}
                                  </span>
                                </div>
                                {note.autoGenerated && (
                                  <Badge variant="outline" className="border-purple-500/50 text-purple-300 text-xs">
                                    ğŸ¤– AI
                                  </Badge>
                                )}
                              </div>
                              <p className="text-white">{note.content}</p>
                            </div>
                          ))}
                        </div>

                        {/* Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© ÙŠØ¯ÙˆÙŠØ© */}
                        <div className="pt-4 border-t border-purple-500/30">
                          <Label className="text-purple-300 mb-2 block">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© ÙŠØ¯ÙˆÙŠØ©</Label>
                          <div className="flex gap-2">
                            <Input
                              placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."
                              className="bg-slate-900/50 border-purple-500/30 text-white"
                            />
                            <Button className="bg-purple-600 hover:bg-purple-700">Ø¥Ø¶Ø§ÙØ©</Button>
                          </div>
                        </div>
                      </div>
                    </TabsContent>
                  ))}
                </Tabs>
              </CardContent>
            </Card>
          </div>
        )}

        {/* ==================== Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ø¬ÙˆØ¯Ø© Casting ==================== */}
        {activeTool === "export" && (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ± */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>âš™ï¸</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ±
                </CardTitle>
                <CardDescription className="text-purple-300">
                  Ø®ØµØµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ± Ù„ØªÙ†Ø§Ø³Ø¨ Ù…ØªØ·Ù„Ø¨Ø§Øª Casting
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØµØ¯ÙŠØ± */}
                <div className="space-y-2">
                  <Label className="text-purple-300">Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØµØ¯ÙŠØ±</Label>
                  <Select
                    value={exportSettings.quality}
                    onValueChange={(value: "casting" | "high" | "medium") =>
                      setExportSettings((prev) => ({ ...prev, quality: value }))
                    }
                  >
                    <SelectTrigger className="bg-slate-900/50 border-purple-500/30 text-white">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent className="bg-slate-900 border-purple-500/30">
                      <SelectItem value="casting" className="text-white">
                        ğŸ¬ Casting Quality (1080p, H.264)
                      </SelectItem>
                      <SelectItem value="high" className="text-white">
                        ğŸ“º High Quality (4K)
                      </SelectItem>
                      <SelectItem value="medium" className="text-white">
                        ğŸ“± Medium (720p)
                      </SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù */}
                <div className="space-y-2">
                  <Label className="text-purple-300">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù</Label>
                  <Select
                    value={exportSettings.format}
                    onValueChange={(value: "mp4" | "mov" | "webm") =>
                      setExportSettings((prev) => ({ ...prev, format: value }))
                    }
                  >
                    <SelectTrigger className="bg-slate-900/50 border-purple-500/30 text-white">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent className="bg-slate-900 border-purple-500/30">
                      <SelectItem value="mp4" className="text-white">
                        MP4 (Ø§Ù„Ø£ÙƒØ«Ø± ØªÙˆØ§ÙÙ‚Ø§Ù‹)
                      </SelectItem>
                      <SelectItem value="mov" className="text-white">
                        MOV (Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©)
                      </SelectItem>
                      <SelectItem value="webm" className="text-white">
                        WebM (Ù„Ù„ÙˆÙŠØ¨)
                      </SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* Slate */}
                <div className="space-y-4 p-4 bg-slate-900/50 rounded-xl">
                  <div className="flex items-center justify-between">
                    <Label className="text-purple-300">Ø¥Ø¶Ø§ÙØ© Slate</Label>
                    <Button
                      variant="outline"
                      size="sm"
                      className={`${
                        exportSettings.includeSlate ? "bg-purple-600 border-purple-600" : "border-purple-500/50"
                      } text-white`}
                      onClick={() =>
                        setExportSettings((prev) => ({
                          ...prev,
                          includeSlate: !prev.includeSlate,
                        }))
                      }
                    >
                      {exportSettings.includeSlate ? "âœ“ Ù…ÙØ¹Ù„" : "Ù…Ø¹Ø·Ù„"}
                    </Button>
                  </div>

                  {exportSettings.includeSlate && (
                    <div className="space-y-4 pt-4 border-t border-purple-500/30">
                      <div>
                        <Label className="text-purple-300 text-sm">Ø§Ø³Ù… Ø§Ù„Ù…Ù…Ø«Ù„</Label>
                        <Input
                          value={exportSettings.actorName}
                          onChange={(e) =>
                            setExportSettings((prev) => ({ ...prev, actorName: e.target.value }))
                          }
                          placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"
                          className="bg-slate-800/50 border-purple-500/30 text-white mt-1"
                        />
                      </div>
                      <div>
                        <Label className="text-purple-300 text-sm">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</Label>
                        <Input
                          value={exportSettings.projectName}
                          onChange={(e) =>
                            setExportSettings((prev) => ({ ...prev, projectName: e.target.value }))
                          }
                          placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù… / Ø§Ù„Ù…Ø³Ù„Ø³Ù„"
                          className="bg-slate-800/50 border-purple-500/30 text-white mt-1"
                        />
                      </div>
                      <div>
                        <Label className="text-purple-300 text-sm">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±</Label>
                        <Input
                          value={exportSettings.roleName}
                          onChange={(e) =>
                            setExportSettings((prev) => ({ ...prev, roleName: e.target.value }))
                          }
                          placeholder="Ø§Ù„Ø´Ø®ØµÙŠØ©"
                          className="bg-slate-800/50 border-purple-500/30 text-white mt-1"
                        />
                      </div>
                      <div>
                        <Label className="text-purple-300 text-sm">Ø§Ù„ÙˆÙƒØ§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</Label>
                        <Input
                          value={exportSettings.agencyName}
                          onChange={(e) =>
                            setExportSettings((prev) => ({ ...prev, agencyName: e.target.value }))
                          }
                          placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©"
                          className="bg-slate-800/50 border-purple-500/30 text-white mt-1"
                        />
                      </div>
                      <div>
                        <Label className="text-purple-300 text-sm">
                          Ù…Ø¯Ø© Slate: {exportSettings.slateDuration} Ø«ÙˆØ§Ù†
                        </Label>
                        <Slider
                          value={[exportSettings.slateDuration]}
                          onValueChange={([value]) =>
                            setExportSettings((prev) => ({ ...prev, slateDuration: value ?? prev.slateDuration }))
                          }
                          min={3}
                          max={10}
                          step={1}
                          className="w-full mt-2"
                        />
                      </div>
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>

            {/* Ø§Ø®ØªÙŠØ§Ø± ÙˆØªØµØ¯ÙŠØ± Takes */}
            <Card className="bg-slate-800/50 border-purple-500/30">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <span>ğŸ“¤</span> ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
                </CardTitle>
              </CardHeader>
              <CardContent>
                {isExporting ? (
                  <div className="text-center py-12">
                    <div className="w-20 h-20 rounded-full border-4 border-purple-500 border-t-transparent animate-spin mx-auto mb-4" />
                    <p className="text-white text-xl mb-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...</p>
                    <Progress value={exportProgress} className="w-full h-3" />
                    <p className="text-purple-300 mt-2">{exportProgress}%</p>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {takes.map((take) => (
                      <div
                        key={take.id}
                        className="bg-slate-900/50 rounded-xl p-4 border border-purple-500/20"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="text-white font-medium">{take.name}</h4>
                            <p className="text-sm text-gray-400">
                              {formatTime(take.duration)} â€¢ ØªÙ‚ÙŠÙŠÙ…: {take.score}%
                            </p>
                          </div>
                          <Button
                            className="bg-green-600 hover:bg-green-700"
                            onClick={() => startExport(take.id)}
                          >
                            ğŸ“¤ ØªØµØ¯ÙŠØ±
                          </Button>
                        </div>
                      </div>
                    ))}

                    {takes.length > 1 && (
                      <div className="pt-4 border-t border-purple-500/30">
                        <Button
                          className="w-full bg-purple-600 hover:bg-purple-700"
                          onClick={() => {
                            const bestTake = takes.reduce((best, current) =>
                              (current.score || 0) > (best.score || 0) ? current : best
                            );
                            startExport(bestTake.id);
                          }}
                        >
                          â­ ØªØµØ¯ÙŠØ± Ø£ÙØ¶Ù„ Take ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                        </Button>
                      </div>
                    )}
                  </div>
                )}

                {/* Ù…Ø¹Ø§ÙŠÙ†Ø© Slate */}
                {exportSettings.includeSlate && exportSettings.actorName && (
                  <div className="mt-6 pt-6 border-t border-purple-500/30">
                    <Label className="text-purple-300 mb-3 block">Ù…Ø¹Ø§ÙŠÙ†Ø© Slate</Label>
                    <div className="aspect-video bg-black rounded-xl p-8 flex flex-col items-center justify-center text-center">
                      <h2 className="text-3xl font-bold text-white mb-2">{exportSettings.actorName}</h2>
                      {exportSettings.projectName && (
                        <p className="text-xl text-purple-300">{exportSettings.projectName}</p>
                      )}
                      {exportSettings.roleName && (
                        <p className="text-lg text-gray-400">Ø§Ù„Ø¯ÙˆØ±: {exportSettings.roleName}</p>
                      )}
                      {exportSettings.agencyName && (
                        <p className="text-sm text-gray-500 mt-4">{exportSettings.agencyName}</p>
                      )}
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        )}
      </main>

      {/* Footer */}
      <footer className="border-t border-purple-500/30 bg-black/30 mt-8">
        <div className="container mx-auto px-4 py-6">
          <div className="flex flex-col md:flex-row items-center justify-between gap-4">
            <p className="text-gray-400 text-sm">
              Self-Tape Suite Â© 2025 - Ø¬Ø²Ø¡ Ù…Ù† Ù…Ù†ØµØ© ActorAI Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            </p>
            <div className="flex items-center gap-4">
              <Badge variant="outline" className="border-purple-500/50 text-purple-300">
                Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© - Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
              </Badge>
              <Badge variant="outline" className="border-green-500/50 text-green-300">
                v1.0.0
              </Badge>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default SelfTapeSuite;
